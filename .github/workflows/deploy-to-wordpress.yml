name: Publish Website

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  Publish-Website:
    name: Publish-Website
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@master

    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.0'

    - name: Validate PHP syntax
      run: |
        echo "ğŸ” Validating PHP syntax..."
        find . -name "*.php" -exec php -l {} \;
        echo "âœ… PHP syntax validation complete"

    - name: Run plugin tests
      run: |
        echo "ğŸ§ª Running plugin validation tests..."
        php -r "
        // Test basic plugin functionality
        if (file_exists('secretary-chatbot.php')) {
          echo 'âœ… Main plugin file exists\n';
        } else {
          echo 'âŒ ERROR: Main plugin file missing\n';
          exit(1);
        }

        if (file_exists('includes/chatbot-logic.php')) {
          echo 'âœ… Chatbot logic file exists\n';
        } else {
          echo 'âŒ ERROR: Chatbot logic file missing\n';
          exit(1);
        }

        if (file_exists('assets/badger.png')) {
          echo 'âœ… Badger avatar exists\n';
        } else {
          echo 'âš ï¸  WARNING: Badger avatar missing\n';
        }

        if (file_exists('assets/chatbot.js')) {
          echo 'âœ… JavaScript file exists\n';
        } else {
          echo 'âŒ ERROR: JavaScript file missing\n';
          exit(1);
        }

        if (file_exists('assets/style.css')) {
          echo 'âœ… CSS file exists\n';
        } else {
          echo 'âŒ ERROR: CSS file missing\n';
          exit(1);
        }

        echo 'ğŸ‰ Plugin validation complete - ready for deployment!\n';
        "

    - name: Upload the artifact
      uses: actions/upload-artifact@v4
      with:
        name: wpcom
        path: |
          .
          !.git*
          !.github/
          !README.md
          !SETUP-INSTRUCTIONS.md
          !deployment-guide.md
          !*.md
        retention-days: 1

    - name: Deployment notification
      run: |
        echo "ğŸš€ Plugin packaged for WordPress.com deployment!"
        echo "ğŸ“¦ Artifact created with name: wpcom"
        echo "ğŸ¯ Ready to deploy to your WordPress.com site"
        echo "âœ… Check your WordPress.com admin to see the deployed plugin"
