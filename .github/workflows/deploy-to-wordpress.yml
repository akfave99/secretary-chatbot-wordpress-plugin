name: Publish Website

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  Publish-Website:
    name: Publish-Website
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@master

    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.0'

    - name: Validate PHP syntax
      run: |
        echo "🔍 Validating PHP syntax..."
        find . -name "*.php" -exec php -l {} \;
        echo "✅ PHP syntax validation complete"

    - name: Run plugin tests
      run: |
        echo "🧪 Running plugin validation tests..."
        php -r "
        // Test basic plugin functionality
        if (file_exists('secretary-chatbot.php')) {
          echo '✅ Main plugin file exists\n';
        } else {
          echo '❌ ERROR: Main plugin file missing\n';
          exit(1);
        }

        if (file_exists('includes/chatbot-logic.php')) {
          echo '✅ Chatbot logic file exists\n';
        } else {
          echo '❌ ERROR: Chatbot logic file missing\n';
          exit(1);
        }

        if (file_exists('assets/badger.png')) {
          echo '✅ Badger avatar exists\n';
        } else {
          echo '⚠️  WARNING: Badger avatar missing\n';
        }

        if (file_exists('assets/chatbot.js')) {
          echo '✅ JavaScript file exists\n';
        } else {
          echo '❌ ERROR: JavaScript file missing\n';
          exit(1);
        }

        if (file_exists('assets/style.css')) {
          echo '✅ CSS file exists\n';
        } else {
          echo '❌ ERROR: CSS file missing\n';
          exit(1);
        }

        echo '🎉 Plugin validation complete - ready for deployment!\n';
        "

    - name: Upload the artifact
      uses: actions/upload-artifact@v4
      with:
        name: wpcom
        path: |
          .
          !.git*
          !.github/
          !README.md
          !SETUP-INSTRUCTIONS.md
          !deployment-guide.md
          !*.md
        retention-days: 1

    - name: Deployment notification
      run: |
        echo "🚀 Plugin packaged for WordPress.com deployment!"
        echo "📦 Artifact created with name: wpcom"
        echo "🎯 Ready to deploy to your WordPress.com site"
        echo "✅ Check your WordPress.com admin to see the deployed plugin"
